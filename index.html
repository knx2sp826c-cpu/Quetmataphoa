<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>T√≠nh ti·ªÅn t·∫°p ho√°</title>

<script src="https://unpkg.com/@zxing/library@latest"></script>

<style>
body {
  font-family: -apple-system, BlinkMacSystemFont;
  background: #f7f7f7;
  padding: 15px;
}
h2 { text-align: center; }
input, button {
  width: 100%;
  font-size: 18px;
  padding: 10px;
  margin: 6px 0;
}
button {
  background: #007aff;
  color: white;
  border: none;
  border-radius: 6px;
}
.list {
  background: white;
  padding: 10px;
  margin-top: 10px;
}
.total {
  font-size: 22px;
  font-weight: bold;
  text-align: right;
}
.history {
  background: #fff;
  margin-top: 15px;
  padding: 10px;
}
video {
  width: 100%;
  display: none;
}
</style>
</head>

<body>

<h2>üßæ T√çNH TI·ªÄN T·∫†P HO√Å</h2>

<button onclick="startScan()">üì∑ Qu√©t m√£ s·∫£n ph·∫©m</button>
<video id="camera"></video>

<input id="name" placeholder="T√™n h√†ng" />
<input id="price" type="number" placeholder="Gi√° (‚Ç´)" />
<input id="qty" type="number" placeholder="S·ªë l∆∞·ª£ng" />

<button onclick="addItem()">‚ûï Th√™m m√≥n</button>

<div class="list" id="list"></div>
<div class="total" id="total">T·ªîNG: 0 ‚Ç´</div>

<button onclick="finishBill()">‚úÖ Ho√†n t·∫•t ho√° ƒë∆°n</button>

<div class="history">
<h3>üìö L·ªãch s·ª≠ h√¥m nay</h3>
<div id="history"></div>
<div class="total" id="dayTotal"></div>
</div>

<script>
let bill = [];
let currentCode = null;

const products = JSON.parse(localStorage.getItem("products") || "{}");
const bills = JSON.parse(localStorage.getItem("bills") || "{}");

const today = new Date().toLocaleDateString("vi-VN");
if (!bills[today]) bills[today] = [];

function startScan() {
  const video = document.getElementById("camera");
  video.style.display = "block";
  const reader = new ZXing.BrowserBarcodeReader();
  reader.decodeFromVideoDevice(null, "camera", (res, err) => {
    if (res) {
      reader.reset();
      video.style.display = "none";
      currentCode = res.text;
      if (products[currentCode]) {
        name.value = products[currentCode].name;
        price.value = products[currentCode].price;
      } else {
        name.value = "";
        price.value = "";
        alert("M√£ m·ªõi ‚Äì nh·∫≠p t√™n v√† gi√°");
      }
    }
  });
}

function addItem() {
  const n = name.value;
  const p = Number(price.value);
  const q = Number(qty.value);
  if (!n || !p || !q) return alert("Nh·∫≠p ƒë·ªß th√¥ng tin");

  if (currentCode && !products[currentCode]) {
    products[currentCode] = { name: n, price: p };
    localStorage.setItem("products", JSON.stringify(products));
  }

  bill.push({ name: n, price: p, qty: q });
  renderBill();
}

function renderBill() {
  let html = "";
  let sum = 0;
  bill.forEach(i => {
    const s = i.price * i.qty;
    sum += s;
    html += `<div>${i.name} x${i.qty} = ${s.toLocaleString()} ‚Ç´</div>`;
  });
  list.innerHTML = html;
  total.innerText = "T·ªîNG: " + sum.toLocaleString() + " ‚Ç´";
}

function finishBill() {
  if (bill.length === 0) return;
  const sum = bill.reduce((t, i) => t + i.price * i.qty, 0);
  bills[today].push({ time: new Date().toLocaleTimeString(), total: sum });
  localStorage.setItem("bills", JSON.stringify(bills));
  bill = [];
  renderBill();
  renderHistory();
}

function renderHistory() {
  let html = "";
  let sum = 0;
  bills[today].forEach(b => {
    html += `<div>${b.time} ‚Äì ${b.total.toLocaleString()} ‚Ç´</div>`;
    sum += b.total;
  });
  history.innerHTML = html;
  dayTotal.innerText = "T·ªîNG NG√ÄY: " + sum.toLocaleString() + " ‚Ç´";
}

renderHistory();
</script>

</body>
</html>
<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
<meta name="apple-mobile-web-app-capable" content="yes">
<title>T√≠nh Ti·ªÅn T·∫°p Ho√° PRO</title>

<script src="https://unpkg.com/@zxing/library@latest"></script>

<style>
  body { font-family: -apple-system, system-ui; background: #f0f2f5; padding: 15px; margin: 0; }
  h2 { text-align: center; color: #1c1e21; }
  .card { background: white; padding: 15px; border-radius: 12px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); margin-bottom: 15px; }
  input { width: 100%; font-size: 16px; padding: 12px; margin: 8px 0; border: 1px solid #ddd; border-radius: 8px; box-sizing: border-box; }
  button { width: 100%; font-size: 16px; padding: 12px; margin: 5px 0; border: none; border-radius: 8px; font-weight: bold; cursor: pointer; }
  .btn-scan { background: #007aff; color: white; }
  .btn-add { background: #34c759; color: white; }
  .btn-finish { background: #ff9500; color: white; margin-top: 20px; }
  
  .item-row { display: flex; justify-content: space-between; align-items: center; padding: 10px 0; border-bottom: 1px solid #eee; }
  .item-info { flex-grow: 1; }
  .qty-controls { display: flex; align-items: center; gap: 10px; }
  .btn-qty { width: 30px; height: 30px; padding: 0; background: #e5e5ea; color: black; border-radius: 50%; }
  
  .total-box { font-size: 22px; font-weight: bold; text-align: right; color: #d70119; margin: 15px 0; }
  video { width: 100%; border-radius: 12px; display: none; margin-bottom: 10px; background: #000; }
  .history-item { font-size: 14px; color: #666; padding: 5px 0; }
</style>
</head>

<body>

<h2>üßæ M√ÅY T√çNH TI·ªÄN</h2>

<div class="card">
  <video id="camera" playsinline webkit-playsinline></video>
  <button class="btn-scan" onclick="startScan()">üì∑ QU√âT M√É V·∫†CH</button>
  
  <input id="name" placeholder="T√™n s·∫£n ph·∫©m" />
  <input id="price" type="number" placeholder="Gi√° b√°n (‚Ç´)" />
  <input id="qty" type="number" value="1" placeholder="S·ªë l∆∞·ª£ng" />
  
  <button class="btn-add" onclick="addItem()">‚ûï TH√äM V√ÄO GI·ªé</button>
</div>

<div class="card">
  <div id="list"><i>Ch∆∞a c√≥ m√≥n n√†o...</i></div>
  <div class="total-box" id="total">T·ªîNG: 0 ‚Ç´</div>
  <button class="btn-finish" onclick="finishBill()">‚úÖ HO√ÄN T·∫§T & L∆ØU H√ìA ƒê∆†N</button>
</div>

<div class="card">
  <h3>üìö L·ªãch s·ª≠ h√¥m nay</h3>
  <div id="history"></div>
  <hr>
  <div class="total-box" id="dayTotal" style="font-size: 18px;">T·ªîNG NG√ÄY: 0 ‚Ç´</div>
</div>

<script>
let bill = [];
let currentCode = null;
const products = JSON.parse(localStorage.getItem("products") || "{}");
const bills = JSON.parse(localStorage.getItem("bills") || "{}");
const today = new Date().toLocaleDateString("vi-VN");
if (!bills[today]) bills[today] = [];

function startScan() {
  const video = document.getElementById("camera");
  video.style.display = "block";
  const reader = new ZXing.BrowserBarcodeReader();
  reader.decodeFromVideoDevice(null, "camera", (res, err) => {
    if (res) {
      reader.reset();
      video.style.display = "none";
      currentCode = res.text;
      
      if (products[currentCode]) {
        document.getElementById("name").value = products[currentCode].name;
        document.getElementById("price").value = products[currentCode].price;
      } else {
        document.getElementById("name").value = "";
        document.getElementById("price").value = "";
        alert("M√£ m·ªõi: " + currentCode + ". Vui l√≤ng nh·∫≠p t√™n v√† gi√°.");
      }
    }
  });
}

function addItem() {
  const n = document.getElementById("name").value;
  const p = Number(document.getElementById("price").value);
  const q = Number(document.getElementById("qty").value);

  if (!n || !p || q <= 0) {
    alert("Vui l√≤ng nh·∫≠p ƒë·ªß T√™n, Gi√° v√† S·ªë l∆∞·ª£ng!");
    return;
  }

  // C·∫¨P NH·∫¨T HO·∫∂C TH√äM M·ªöI V√ÄO DANH M·ª§C (L∆∞u gi√° m·ªõi nh·∫•t)
  if (currentCode) {
    products[currentCode] = { name: n, price: p };
    localStorage.setItem("products", JSON.stringify(products));
  }

  // Th√™m v√†o danh s√°ch ch·ªù thanh to√°n
  const existingItem = bill.find(item => item.name === n && item.price === p);
  if (existingItem) {
    existingItem.qty += q;
  } else {
    bill.push({ name: n, price: p, qty: q });
  }

  // Reset form
  document.getElementById("name").value = "";
  document.getElementById("price").value = "";
  document.getElementById("qty").value = "1";
  currentCode = null;

  renderBill();
}

function updateQty(index, delta) {
  bill[index].qty += delta;
  if (bill[index].qty <= 0) bill.splice(index, 1);
  renderBill();
}

function renderBill() {
  const listDiv = document.getElementById("list");
  let html = "";
  let sum = 0;
  
  bill.forEach((item, index) => {
    const s = item.price * item.qty;
    sum += s;
    html += `
      <div class="item-row">
        <div class="item-info">
          <b>${item.name}</b><br>
          <small>${item.price.toLocaleString()} ‚Ç´</small>
        </div>
        <div class="qty-controls">
          <button class="btn-qty" onclick="updateQty(${index}, -1)">-</button>
          <span>${item.qty}</span>
          <button class="btn-qty" onclick="updateQty(${index}, 1)">+</button>
        </div>
        <div style="min-width: 80px; text-align: right;">${s.toLocaleString()} ‚Ç´</div>
      </div>`;
  });
  
  listDiv.innerHTML = html || "<i>Ch∆∞a c√≥ m√≥n n√†o...</i>";
  document.getElementById("total").innerText = "T·ªîNG: " + sum.toLocaleString() + " ‚Ç´";
}

function finishBill() {
  if (bill.length === 0) return;
  const sum = bill.reduce((t, i) => t + i.price * i.qty, 0);
  bills[today].push({ time: new Date().toLocaleTimeString(), total: sum });
  localStorage.setItem("bills", JSON.stringify(bills));
  bill = [];
  renderBill();
  renderHistory();
  alert("ƒê√£ l∆∞u h√≥a ƒë∆°n!");
}

function renderHistory() {
  const historyDiv = document.getElementById("history");
  let html = "";
  let sum = 0;
  if (bills[today]) {
    bills[today].forEach(b => {
      html += `<div class="history-item">üïí ${b.time} - üí∞ ${b.total.toLocaleString()} ‚Ç´</div>`;
      sum += b.total;
    });
  }
  historyDiv.innerHTML = html || "Ch∆∞a c√≥ giao d·ªãch.";
  document.getElementById("dayTotal").innerText = "T·ªîNG NG√ÄY: " + sum.toLocaleString() + " ‚Ç´";
}

renderHistory();
</script>

</body>
</html>
